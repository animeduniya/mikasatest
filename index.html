<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SkyAnime</title>
  <style>
    body {
      font-family: sans-serif;
      background: #1e1e1e;
      color: white;
      padding: 20px;
    }
    input {
      padding: 8px;
      width: 200px;
    }
    a {
      color: #00bfff;
      text-decoration: none;
      margin-bottom: 5px;
      display: inline-block;
    }
    #animeResults div, #episodeList a {
      margin-top: 8px;
    }
    #episodeList, #playerContainer {
      margin-top: 20px;
    }
    iframe {
      width: 100%;
      height: 500px;
      border: none;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>SkyAnime</h1>

  <div id="homeView">
    <input type="text" id="searchInput" placeholder="Search anime...">
    <button onclick="searchAnime()">Search</button>
    <div id="animeResults"></div>
  </div>

  <div id="animeView" style="display:none;">
    <h2 id="animeTitle">Anime Title</h2>
    <button onclick="goBack()">Back</button>
    <div id="episodeList"></div>
  </div>

  <div id="watchView" style="display:none;">
    <h2>Episode Player</h2>
    <button onclick="goBackToAnime()">Back to Episodes</button>
    <div id="playerContainer">
      <iframe id="video" allowfullscreen></iframe>
    </div>
  </div>

  <script>
    const searchAnime = () => {
      const query = document.getElementById("searchInput").value;
      fetch(`https://api.anitaku.to/ajax/search?keyword=${query}`)
        .then(res => res.json())
        .then(data => {
          const results = document.getElementById("animeResults");
          results.innerHTML = "";
          data.result.forEach(anime => {
            const div = document.createElement("div");
            const a = document.createElement("a");
            a.href = "#";
            a.textContent = anime.name;
            a.onclick = () => loadAnime(anime.id, anime.name);
            div.appendChild(a);
            results.appendChild(div);
          });
        });
    };

    const loadAnime = (id, title) => {
      document.getElementById("homeView").style.display = "none";
      document.getElementById("animeView").style.display = "block";
      document.getElementById("watchView").style.display = "none";
      document.getElementById("animeTitle").textContent = title;

      fetch(`https://api.anitaku.to/ajax/episode/list/${id}`)
        .then(res => res.json())
        .then(data => {
          const list = document.getElementById("episodeList");
          list.innerHTML = "";
          Object.entries(data.episode).reverse().forEach(([key, ep]) => {
            const link = document.createElement("a");
            link.href = "#";
            link.textContent = `Episode ${key}`;
            link.onclick = () => watchEpisode(ep.id);
            list.appendChild(link);
          });
        });
    };

    const watchEpisode = (episodeId) => {
      document.getElementById("homeView").style.display = "none";
      document.getElementById("animeView").style.display = "none";
      document.getElementById("watchView").style.display = "block";
      document.getElementById("video").src = `https://anitaku.to/streaming.php?id=${episodeId}`;
    };

    const goBack = () => {
      document.getElementById("homeView").style.display = "block";
      document.getElementById("animeView").style.display = "none";
      document.getElementById("watchView").style.display = "none";
    };

    const goBackToAnime = () => {
      document.getElementById("animeView").style.display = "block";
      document.getElementById("watchView").style.display = "none";
    };
  </script>
</body>
</html>
