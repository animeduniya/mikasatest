<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Streaming</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1e1e1e;
            color: white;
        }
        header {
            text-align: center;
            margin-top: 50px;
        }
        input[type="text"] {
            padding: 10px;
            width: 300px;
            margin: 20px;
        }
        .anime-list, .episode-list {
            list-style-type: none;
            padding: 0;
        }
        .anime-list li, .episode-list li {
            background-color: #333;
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
        }
        .episode-list li {
            cursor: pointer;
            color: #4CAF50;
        }
    </style>
</head>
<body>
    <header>
        <h1>Anime Streaming Website</h1>
        <input type="text" id="anime-search" placeholder="Search for Anime..." oninput="searchAnime()">
    </header>

    <section id="anime-results">
        <h2>Search Results</h2>
        <ul class="anime-list" id="anime-list"></ul>
    </section>

    <section id="episode-results" style="display:none;">
        <h2>Episodes</h2>
        <ul class="episode-list" id="episode-list"></ul>
    </section>

    <section id="video-player" style="display:none;">
        <h2>Video Player</h2>
        <video id="anime-player" controls></video>
    </section>

    <script>
        const CORS_PROXY = "https://api.allorigins.win/get?url=";
        const HIANIME_API = "https://hianime-up.vercel.app/api/v2/hianime/";

        // Search for anime using Anilist or Kitsu API
        async function searchAnime() {
            const searchQuery = document.getElementById('anime-search').value;
            if (searchQuery.length < 3) return;

            // Call an external API (like Anilist or Kitsu) to search for anime based on the query
            const response = await fetch(`https://api.anilist.co/graphql?query={media(search: "${searchQuery}") {id title {english}}}`);
            const data = await response.json();

            displayAnimeResults(data);
        }

        // Display search results
        function displayAnimeResults(data) {
            const animeList = document.getElementById('anime-list');
            animeList.innerHTML = '';  // Clear previous results
            data.data.Page.media.forEach(anime => {
                const li = document.createElement('li');
                li.textContent = anime.title.english || 'Unknown Title';
                li.onclick = () => fetchAnimeEpisodes(anime.id);
                animeList.appendChild(li);
            });
        }

        // Fetch episodes for the selected anime
        async function fetchAnimeEpisodes(animeId) {
            const response = await fetch(CORS_PROXY + encodeURIComponent(`${HIANIME_API}anime/${animeId}/episodes`));
            const data = await response.json();
            displayEpisodes(data);
        }

        // Display episodes
        function displayEpisodes(data) {
            const episodeList = document.getElementById('episode-list');
            episodeList.innerHTML = '';  // Clear previous episodes
            data.data.episodes.forEach(episode => {
                const li = document.createElement('li');
                li.textContent = episode.title;
                li.onclick = () => fetchEpisodeServers(episode.episodeId);
                episodeList.appendChild(li);
            });
            document.getElementById('episode-results').style.display = 'block';
        }

        // Fetch episode servers (video sources)
        async function fetchEpisodeServers(episodeId) {
            const response = await fetch(CORS_PROXY + encodeURIComponent(`${HIANIME_API}episode/servers?animeEpisodeId=${episodeId}`));
            const data = await response.json();
            displayStreamingLinks(data);
        }

        // Display video sources and start playing
        function displayStreamingLinks(data) {
            const episodeId = data.data.episodeId;
            const server = 'hd-2';
            const category = 'sub';  // or 'dub' or 'raw'
            
            fetch(CORS_PROXY + encodeURIComponent(`${HIANIME_API}episode/sources?animeEpisodeId=${episodeId}&server=${server}&category=${category}`))
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.data.sources.length > 0) {
                        const videoUrl = data.data.sources[0].url;
                        const videoPlayer = document.getElementById('anime-player');
                        videoPlayer.src = videoUrl;
                        videoPlayer.style.display = 'block';
                    }
                });
        }
    </script>
</body>
</html>
