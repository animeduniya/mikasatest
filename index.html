<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Watch</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1e1e1e;
            color: white;
            margin: 0;
            padding: 0;
        }
        .container {
            padding: 20px;
        }
        .anime-list {
            display: flex;
            flex-wrap: wrap;
        }
        .anime-item {
            width: 200px;
            margin: 10px;
            text-align: center;
        }
        .anime-item img {
            width: 100%;
            border-radius: 8px;
        }
        .anime-item a {
            color: #fff;
            text-decoration: none;
        }
        .anime-item a:hover {
            color: #ff4500;
        }
        .button {
            background-color: #ff4500;
            border: none;
            color: white;
            padding: 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            cursor: pointer;
        }
        .button:hover {
            background-color: #ff6347;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Anime Watch</h1>
    <div id="anime-list" class="anime-list"></div>
    <div id="anime-details"></div>
</div>

<script>
// Base URL of the API
const BASE_URL = "https://api-consumet-idk.vercel.app";

// Function to fetch anime list from AnimeKai server
async function fetchAnimeList() {
    try {
        const response = await fetch(`${BASE_URL}/animekai/anime?page=1`);
        const data = await response.json();
        displayAnimeList(data);
    } catch (error) {
        console.error('Error fetching anime list:', error);
    }
}

// Function to display anime list on the page
function displayAnimeList(animeList) {
    const animeListContainer = document.getElementById('anime-list');
    animeListContainer.innerHTML = ''; // Clear previous content

    animeList.forEach(anime => {
        const animeItem = document.createElement('div');
        animeItem.classList.add('anime-item');
        animeItem.innerHTML = `
            <img src="${anime.image}" alt="${anime.title}">
            <a href="javascript:void(0);" onclick="fetchAnimeDetails(${anime.id})">${anime.title}</a>
        `;
        animeListContainer.appendChild(animeItem);
    });
}

// Function to fetch anime details
async function fetchAnimeDetails(animeId) {
    try {
        const response = await fetch(`${BASE_URL}/animekai/anime/${animeId}`);
        const data = await response.json();
        displayAnimeDetails(data);
    } catch (error) {
        console.error('Error fetching anime details:', error);
    }
}

// Function to display anime details and episodes
function displayAnimeDetails(anime) {
    const animeDetailsContainer = document.getElementById('anime-details');
    animeDetailsContainer.innerHTML = `
        <h2>${anime.title}</h2>
        <img src="${anime.image}" alt="${anime.title}" style="max-width: 300px;">
        <p>${anime.description}</p>
        <h3>Episodes</h3>
        <div id="episodes"></div>
        <button class="button" onclick="playFirstEpisode(${anime.id})">Play First Episode</button>
    `;

    // Fetch and display episodes
    fetchEpisodes(anime.id);
}

// Function to fetch episodes for a specific anime
async function fetchEpisodes(animeId) {
    try {
        const response = await fetch(`${BASE_URL}/animekai/anime/${animeId}/episodes`);
        const data = await response.json();
        displayEpisodes(data);
    } catch (error) {
        console.error('Error fetching episodes:', error);
    }
}

// Function to display episodes
function displayEpisodes(episodes) {
    const episodesContainer = document.getElementById('episodes');
    episodesContainer.innerHTML = ''; // Clear previous episodes

    episodes.forEach(episode => {
        const episodeItem = document.createElement('div');
        episodeItem.classList.add('episode-item');
        episodeItem.innerHTML = `
            <a href="javascript:void(0);" onclick="playEpisode(${episode.id})">${episode.title}</a>
        `;
        episodesContainer.appendChild(episodeItem);
    });
}

// Function to play the first episode or a specific episode
async function playFirstEpisode(animeId) {
    const episodesResponse = await fetch(`${BASE_URL}/animekai/anime/${animeId}/episodes`);
    const episodesData = await episodesResponse.json();
    const firstEpisode = episodesData[0]; // First episode
    playEpisode(firstEpisode.id);
}

// Function to fetch and play a specific episode
async function playEpisode(episodeId) {
    try {
        const response = await fetch(`${BASE_URL}/animekai/episode/${episodeId}/sources`);
        const data = await response.json();
        const streamUrl = data.sources[0].url; // Get the first stream URL
        window.open(streamUrl, '_blank'); // Open the stream URL in a new tab
    } catch (error) {
        console.error('Error fetching episode stream URL:', error);
    }
}

// Initial call to fetch the anime list
fetchAnimeList();
</script>

</body>
</html>
