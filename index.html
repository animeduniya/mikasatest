<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Streaming</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        nav {
            background: #333;
            color: white;
            padding: 10px;
            text-align: center;
        }
        nav a {
            color: white;
            margin: 0 15px;
            text-decoration: none;
        }
        h1 {
            text-align: center;
        }
        #anime-list {
            list-style-type: none;
            padding: 0;
        }
        .anime-item {
            background: white;
            margin: 10px 0;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .anime-item h2 {
            margin: 0;
        }
        video {
            width: 100%;
            max-width: 600px;
            margin: 20px auto;
            display: none;
        }
        .content {
            display: none;
        }
        .active {
            display: block;
        }
    </style>
</head>
<body>

<nav>
    <a href="#" id="home-link">Home</a>
    <a href="#" id="anime-list-link">Top Anime</a>
</nav>

<div id="home" class="content active">
    <h1>Welcome to Anime Streaming</h1>
    <p>Your one-stop destination for streaming anime episodes. Explore various titles and enjoy your favorite anime!</p>
</div>

<div id="anime-list-container" class="content">
    <h1>Top Anime</h1>
    <ul id="anime-list"></ul>
    <video id="video-player" controls></video>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    const baseUrl = "https://opapi-lyart.vercel.app";
    const animeListElement = document.getElementById('anime-list');
    const videoPlayer = document.getElementById('video-player');
    const home = document.getElementById('home');
    const animeListContainer = document.getElementById('anime-list-container');

    // Show Home
    document.getElementById('home-link').addEventListener('click', function() {
        home.classList.add('active');
        animeListContainer.classList.remove('active');
    });

    // Show Anime List
    document.getElementById('anime-list-link').addEventListener('click', function() {
        animeListContainer.classList.add('active');
        home.classList.remove('active');
        fetchAnimeList(); // Fetch the anime list when the page is opened
    });

    // Function to fetch anime episodes
    async function fetchAnimeList() {
        try {
            const response = await axios.get(`${baseUrl}/api/most-popular?page=1`);
            const animeList = response.data.results.data;

            animeListElement.innerHTML = ""; // Clear previous list
            animeList.forEach(anime => {
                const animeItem = document.createElement('li');
                animeItem.classList.add('anime-item');
                animeItem.innerHTML = `<h2>${anime.title}</h2><button onclick="playAnime('${anime.id}')">Watch Episode</button>`;
                animeListElement.appendChild(animeItem);
            });
        } catch (error) {
            console.error("Error fetching anime:", error);
        }
    }

    // Function to play the chosen anime episode
    async function playAnime(animeId) {
        try {
            const response = await axios.get(`${baseUrl}/api/episodes/${animeId}`);
            const episode = response.data.results.episodes[0]; // Get the first episode
            const streamResponse = await axios.get(`${baseUrl}/api/stream?id=${animeId}&server=hd-2&type=sub`);
            const streamingLink = streamResponse.data.results.streamingLink[0].link.file; // Get the streaming link

            videoPlayer.src = streamingLink;
            videoPlayer.style.display = "block"; // Show video player
            videoPlayer.play(); // Auto play
        } catch (error) {
            console.error("Error playing anime:", error);
        }
    }

    // Initial fetch of anime list on link click
    document.getElementById('anime-list-link').addEventListener('click', fetchAnimeList);
</script>

</body>
</html>
