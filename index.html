<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }
        #chatbox {
            border: 1px solid #ccc;
            width: 400px;
            height: 500px;
            overflow-y: auto;
            margin: 20px auto;
            padding: 10px;
            background-color: #fff;
        }
        .message {
            margin: 5px 0;
        }
        .user {
            text-align: right;
            color: blue;
        }
        .bot {
            text-align: left;
            color: green;
        }
        #userInput {
            width: 300px;
        }
    </style>
</head>
<body>

<div id="chatbox"></div>
<input type="text" id="userInput" placeholder="Type your message..." />
<button id="sendButton">Send</button>

<script src="https://cdn.jsdelivr.net/npm/puter.js"></script>
<script>
    const chatbotName = "Mikasa";
    const chatMessages = [];
    const chatAnswers = [];
    const voiceEnabled = true; // Set to true if you want voice responses

    function delayResponse() {
        return new Promise(resolve => setTimeout(resolve, 1000)); // 1 second delay
    }

    function speakResponse(response) {
        const utterance = new SpeechSynthesisUtterance(response);
        speechSynthesis.speak(utterance);
    }

    async function sendMessage() {
        const userInput = document.getElementById("userInput");
        const chatbox = document.getElementById("chatbox");

        if (userInput.value.trim()) {
            const userMessage = userInput.value.trim();
            const userMessageDiv = document.createElement("div");
            userMessageDiv.className = "message user";
            userMessageDiv.textContent = ": " + userMessage;
            chatbox.appendChild(userMessageDiv);
            chatMessages.push(userMessage); // Store user question

            // Stop any ongoing speech
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }

            const typingIndicator = document.createElement("div");
            typingIndicator.innerHTML = "<em> Mikasa is typing...</em>";
            chatbox.appendChild(typingIndicator);

            try {
                await delayResponse(); // Simulate typing delay

                let response;
                const query = userMessage;

                // Predefined responses
                if (/what's your name|who are you/i.test(query)) {
                    response = `My name is ${chatbotName}.`;
                } else if (/who made you|your creator/i.test(query)) {
                    response = "I was made by Rishab.";
                } else if (/reminder/i.test(query)) {
                    response = "I will remind you in a minute.";
                } else {
                    // Using GPT-4o model from Puter.js
                    response = await puter.ai.chat(query, { model: "gpt-4o" });
                }

                chatbox.removeChild(typingIndicator);

                const botMessageDiv = document.createElement("div");
                botMessageDiv.className = "message bot";
                botMessageDiv.textContent = ` ${chatbotName}: ${response || "I'm still learning!"}`;
                chatbox.appendChild(botMessageDiv);

                // Store the answer
                chatAnswers.push(` ${chatbotName}: ${response || "I'm still learning!"}`);

                // Speak response only if voice is enabled
                if (voiceEnabled) {
                    speakResponse(response);
                }

            } catch (error) {
                const errorMessageDiv = document.createElement("div");
                errorMessageDiv.className = "message bot";
                errorMessageDiv.textContent = ` ${chatbotName}: Oops! Something went wrong. Please try again.`;
                chatbox.appendChild(errorMessageDiv);
            }

            chatbox.scrollTop = chatbox.scrollHeight; // Auto scroll
            userInput.value = ""; // Clear input
        }
    }

    document.getElementById("sendButton").addEventListener("click", sendMessage);
    document.getElementById("userInput").addEventListener("keypress", function(e) {
        if (e.key === "Enter") {
            sendMessage();
        }
    });
</script>

</body>
</html>
